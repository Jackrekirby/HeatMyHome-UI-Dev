const output = {
    "demand": {
        "boiler": {
            "hot-water": 1460.07,
            "space": 1515.96,
            "total": 2976.03,
            "peak-hourly": 8.36874
        },
        "heat-pump": {
            "hot-water": 1460.07,
            "space": 1552.12,
            "total": 3012.19,
            "peak-hourly": 1.56076
        }
    },
    "systems": {
        "electric-boiler": {
            "none": {
                "pv-size": 0,
                "solar-thermal-size": 0,
                "thermal-energy-storage-volume": 0.1,
                "operational-expenditure": 232.091,
                "capital-expenditure": 678.913,
                "net-present-cost": 4092.94,
                "operational-emissions": 644775
            },
            "photovoltaic": {
                "pv-size": 14,
                "solar-thermal-size": 0,
                "thermal-energy-storage-volume": 0.1,
                "operational-expenditure": -35.5481,
                "capital-expenditure": 3758.91,
                "net-present-cost": 3236.01,
                "operational-emissions": 214478
            },
            "flat-plate": {
                "pv-size": 0,
                "solar-thermal-size": 2,
                "thermal-energy-storage-volume": 0.1,
                "operational-expenditure": 173.86,
                "capital-expenditure": 3256.41,
                "net-present-cost": 5813.87,
                "operational-emissions": 507729
            },
            "evacuated-tube": {
                "pv-size": 0,
                "solar-thermal-size": 2,
                "thermal-energy-storage-volume": 0.1,
                "operational-expenditure": 157.84,
                "capital-expenditure": 3366.41,
                "net-present-cost": 5688.21,
                "operational-emissions": 463252
            },
            "flat-plate-and-photovoltaic": {
                "pv-size": 12,
                "solar-thermal-size": 2,
                "thermal-energy-storage-volume": 0.1,
                "operational-expenditure": -39.0105,
                "capital-expenditure": 5896.41,
                "net-present-cost": 5322.57,
                "operational-emissions": 182792
            },
            "evacuated-tube-and-photovoltaic": {
                "pv-size": 12,
                "solar-thermal-size": 2,
                "thermal-energy-storage-volume": 0.1,
                "operational-expenditure": -64.4958,
                "capital-expenditure": 6006.41,
                "net-present-cost": 5057.69,
                "operational-emissions": 115537
            },
            "photovoltaic-thermal-hybrid": {
                "pv-size": 4,
                "solar-thermal-size": 4,
                "thermal-energy-storage-volume": 0.1,
                "operational-expenditure": 102.037,
                "capital-expenditure": 5323.91,
                "net-present-cost": 6824.87,
                "operational-emissions": 364656
            }
        },
        "air-source-heat-pump": {
            "none": {
                "pv-size": 0,
                "solar-thermal-size": 0,
                "thermal-energy-storage-volume": 0.1,
                "operational-expenditure": 79.5922,
                "capital-expenditure": 6237.67,
                "net-present-cost": 7408.46,
                "operational-emissions": 232146
            },
            "photovoltaic": {
                "pv-size": 14,
                "solar-thermal-size": 0,
                "thermal-energy-storage-volume": 0.1,
                "operational-expenditure": -197.882,
                "capital-expenditure": 9317.67,
                "net-present-cost": 6406.86,
                "operational-emissions": -182272
            },
            "flat-plate": {
                "pv-size": 0,
                "solar-thermal-size": 2,
                "thermal-energy-storage-volume": 0.1,
                "operational-expenditure": 58.3877,
                "capital-expenditure": 8815.17,
                "net-present-cost": 9674.04,
                "operational-emissions": 191942
            },
            "evacuated-tube": {
                "pv-size": 0,
                "solar-thermal-size": 2,
                "thermal-energy-storage-volume": 0.1,
                "operational-expenditure": 52.8353,
                "capital-expenditure": 8925.17,
                "net-present-cost": 9702.37,
                "operational-emissions": 178927
            },
            "flat-plate-and-photovoltaic": {
                "pv-size": 12,
                "solar-thermal-size": 2,
                "thermal-energy-storage-volume": 0.1,
                "operational-expenditure": -171.235,
                "capital-expenditure": 11455.2,
                "net-present-cost": 8936.33,
                "operational-emissions": -153667
            },
            "evacuated-tube-and-photovoltaic": {
                "pv-size": 12,
                "solar-thermal-size": 2,
                "thermal-energy-storage-volume": 0.1,
                "operational-expenditure": -186.652,
                "capital-expenditure": 11565.2,
                "net-present-cost": 8819.54,
                "operational-emissions": -177541
            },
            "photovoltaic-thermal-hybrid": {
                "pv-size": 2,
                "solar-thermal-size": 2,
                "thermal-energy-storage-volume": 0.1,
                "operational-expenditure": 37.9702,
                "capital-expenditure": 10245.2,
                "net-present-cost": 10803.7,
                "operational-emissions": 158842
            }
        },
        "ground-source-heat-pump": {
            "none": {
                "pv-size": 0,
                "solar-thermal-size": 0,
                "thermal-energy-storage-volume": 0.1,
                "operational-expenditure": 53.459,
                "capital-expenditure": 7937.67,
                "net-present-cost": 8724.04,
                "operational-emissions": 154280
            },
            "photovoltaic": {
                "pv-size": 14,
                "solar-thermal-size": 0,
                "thermal-energy-storage-volume": 0.1,
                "operational-expenditure": -247.103,
                "capital-expenditure": 11017.7,
                "net-present-cost": 7382.83,
                "operational-emissions": -260026
            },
            "flat-plate": {
                "pv-size": 0,
                "solar-thermal-size": 2,
                "thermal-energy-storage-volume": 0.1,
                "operational-expenditure": 39.7321,
                "capital-expenditure": 10515.2,
                "net-present-cost": 11099.6,
                "operational-emissions": 134456
            },
            "evacuated-tube": {
                "pv-size": 0,
                "solar-thermal-size": 2,
                "thermal-energy-storage-volume": 0.1,
                "operational-expenditure": 36.1047,
                "capital-expenditure": 10625.2,
                "net-present-cost": 11156.3,
                "operational-emissions": 128096
            },
            "flat-plate-and-photovoltaic": {
                "pv-size": 12,
                "solar-thermal-size": 2,
                "thermal-energy-storage-volume": 0.1,
                "operational-expenditure": -211.235,
                "capital-expenditure": 13155.2,
                "net-present-cost": 10047.9,
                "operational-emissions": -216005
            },
            "evacuated-tube-and-photovoltaic": {
                "pv-size": 12,
                "solar-thermal-size": 2,
                "thermal-energy-storage-volume": 0.1,
                "operational-expenditure": -223.614,
                "capital-expenditure": 13265.2,
                "net-present-cost": 9975.85,
                "operational-emissions": -229065
            },
            "photovoltaic-thermal-hybrid": {
                "pv-size": 2,
                "solar-thermal-size": 2,
                "thermal-energy-storage-volume": 0.1,
                "operational-expenditure": 19.2099,
                "capital-expenditure": 11945.2,
                "net-present-cost": 12227.7,
                "operational-emissions": 101650
            }
        },
        "hydrogen-boiler": {
            "grey": {
                "operational-expenditure": 162.028,
                "capital-expenditure": 2120,
                "net-present-cost": 4503.41,
                "operational-emissions": 1263160
            },
            "blue": {
                "operational-expenditure": 307.523,
                "capital-expenditure": 2120,
                "net-present-cost": 6643.61,
                "operational-emissions": 198402
            },
            "green": {
                "operational-expenditure": 608.432,
                "capital-expenditure": 2120,
                "net-present-cost": 11069.9,
                "operational-emissions": 1314410
            }
        },
        "hydrogen-fuel-cell": {
            "grey": {
                "operational-expenditure": 157.018,
                "capital-expenditure": 25157.8,
                "net-present-cost": 27467.5,
                "operational-emissions": 1224100
            },
            "blue": {
                "operational-expenditure": 298.015,
                "capital-expenditure": 25157.8,
                "net-present-cost": 29541.6,
                "operational-emissions": 192267
            },
            "green": {
                "operational-expenditure": 589.62,
                "capital-expenditure": 25157.8,
                "net-present-cost": 33831,
                "operational-emissions": 1273770
            }
        },
        "gas-boiler": {
            "operational-expenditure": 132.268,
            "capital-expenditure": 1620,
            "net-present-cost": 3565.64,
            "operational-emissions": 605126
        },
        "biomass-boiler": {
            "operational-expenditure": 135.905,
            "capital-expenditure": 9750,
            "net-present-cost": 11749.1,
            "operational-emissions": 297603
        }
    }
}

const system_order = [
    'electric-boiler',
    'air-source-heat-pump',
    'ground-source-heat-pump',
    'biomass-boiler',
    'gas-boiler',
    'hydrogen-boiler',
    'hydrogen-fuel-cell'
];

const system_names = {
    'electric-boiler': 'Electric Boiler',
    'air-source-heat-pump': 'Air Source<br>Heat Pump',
    'ground-source-heat-pump': 'Ground Source<br>Heat Pump',
    'hydrogen-boiler': 'Hydrogen<br>Boiler',
    'hydrogen-fuel-cell': 'Hydrogen<br>Fuel Cell',
    'biomass-boiler': 'Biomass Boiler',
    'gas-boiler': 'Gas Boiler',
};


const solar_order = [
    'none',
    'photovoltaic',
    'flat-plate',
    'evacuated-tube',
    'flat-plate-and-photovoltaic',
    'evacuated-tube-and-photovoltaic',
    'photovoltaic-thermal-hybrid',
]

const info_format = {
    'thermal-energy-storage-volume': (v) => { return v },
    'operational-expenditure': (v) => { return Math.round(v) },
    'capital-expenditure': (v) => { return Math.round(v) },
    'net-present-cost': (v) => { return Math.round(v) },
    'operational-emissions': (v) => { return Math.round(v / 1000) },
}

const h2_order = ['green', 'blue', 'grey'];

const full_order = {
    'electric-boiler': solar_order,
    'air-source-heat-pump': solar_order,
    'ground-source-heat-pump': solar_order,
    'hydrogen-boiler': h2_order,
    'hydrogen-fuel-cell': h2_order,
    'biomass-boiler': undefined,
    'gas-boiler': undefined,
}



function build_main_table() {
    const table_headers = [
        "Heating Technology",
        "Solar<br>Ancilleries",
        "Water Tank<br>Volume (m<sup>3</sup>)",
        "Upfront Cost<br>(£)",
        "Yearly Cost<br>(£)",
        "Lifetime Cost<br>(£)",
        "Yearly Emissions<br>(kgCO<sub>2</sub>eq)",
    ];

    let table = document.getElementById('output-main-table');
    table.innerHTML = '';
    {
        let tr = document.createElement('tr');
        for (let header of table_headers) {
            console.log(header);

            let th = document.createElement('th');
            if (header == "Solar<br>Ancilleries") {
                th.colSpan = 2;
            }
            let div = document.createElement('div');
            div.innerHTML = header;
            th.appendChild(div);
            tr.appendChild(th);
        }
        table.appendChild(tr);
    }

    let system_list = [
        'electric-boiler',
        'air-source-heat-pump',
        'ground-source-heat-pump'
    ];

    for (let system_name of system_list) {
        for (let subsystem_name of solar_order) {
            let tr = document.createElement('tr');
            if (subsystem_name == solar_order[0]) {
                let td = document.createElement('td');
                td.classList.add('heat-tech');
                td.rowSpan = 7;
                let div = document.createElement('div');
                div.innerHTML = system_names[system_name];
                td.appendChild(div);
                tr.appendChild(td);
            }

            let system_properties = output.systems[system_name][subsystem_name];
            console.log(system_properties);

            let pv_size = system_properties['pv-size'];
            let sts = system_properties['solar-thermal-size'];
            switch (subsystem_name) {
                case 'none': {
                    let td = document.createElement('td');
                    td.classList.add('ancillery');
                    td.colSpan = 2;
                    td.innerHTML = 'None';
                    tr.appendChild(td);
                }
                    break;
                case 'photovoltaic': {
                    let td = document.createElement('td');
                    td.classList.add('ancillery');
                    td.colSpan = 2;
                    td.innerHTML = `${pv_size}m<sup>2</sup> PV`;
                    tr.appendChild(td);
                }
                    break;
                case 'flat-plate': {
                    let td = document.createElement('td');
                    td.classList.add('ancillery');
                    td.colSpan = 2;
                    td.innerHTML = `${sts}m<sup>2</sup> FP`;
                    tr.appendChild(td);
                }
                    break;
                case 'evacuated-tube': {
                    let td = document.createElement('td');
                    td.classList.add('ancillery');
                    td.colSpan = 2;
                    td.innerHTML = `${sts}m<sup>2</sup> ET`;
                    tr.appendChild(td);
                }
                    break;
                case 'flat-plate-and-photovoltaic': {
                    let td = document.createElement('td');
                    td.classList.add('ancillery');
                    td.innerHTML = `${pv_size}m<sup>2</sup> PV`;
                    tr.appendChild(td);
                    td = document.createElement('td');
                    td.classList.add('ancillery');
                    td.innerHTML = `${sts}m<sup>2</sup> FP`;
                    tr.appendChild(td);
                }
                    break;
                case 'evacuated-tube-and-photovoltaic': {
                    let td = document.createElement('td');
                    td.classList.add('ancillery');
                    td.innerHTML = `${pv_size}m<sup>2</sup> PV`;
                    tr.appendChild(td);
                    td = document.createElement('td');
                    td.classList.add('ancillery');
                    td.innerHTML = `${sts}m<sup>2</sup> ET`;
                    tr.appendChild(td);
                }
                    break;
                case 'photovoltaic-thermal-hybrid': {
                    let td = document.createElement('td');
                    td.classList.add('ancillery');
                    td.colSpan = 2;
                    td.innerHTML = `${pv_size}m<sup>2</sup> PVT`;
                    tr.appendChild(td);
                }
                    break;
            }

            for (let [property_name, fmt_fnc] of Object.entries(info_format)) {
                let value = fmt_fnc(system_properties[property_name]);
                let td = document.createElement('td');
                td.innerText = value;
                tr.appendChild(td);
            }
            table.appendChild(tr);
        }
    }
}

function build_hydrogen_table() {
    const table_headers = [
        "Heating Technology",
        "Hydrogen<br>Source",
        "Upfront Cost<br>(£)",
        "Yearly Cost<br>(£)",
        "Lifetime Cost<br>(£)",
        "Yearly Emissions<br>(kgCO<sub>2</sub>eq)",
    ];

    let table = document.getElementById('output-main-table');
    // table.innerHTML = '';

    {
        let tr = document.createElement('tr');
        for (let header of table_headers) {
            console.log(header);
            let th = document.createElement('th');
            if (header == "Hydrogen<br>Source") {
                th.colSpan = 3;
            }
            let div = document.createElement('div');
            div.innerHTML = header;
            th.appendChild(div);
            tr.appendChild(th);
        }
        table.appendChild(tr);
    }

    let system_list = [
        'hydrogen-boiler',
        'hydrogen-fuel-cell'
    ];

    let hydrogen_order = [
        'green', 'blue', 'grey'
    ]

    let hydrogen_display_names = {
        'green': 'Green', 'blue': 'Blue', 'grey': 'Grey'
    }

    const h2_format = {
        'operational-expenditure': (v) => { return Math.round(v) },
        'capital-expenditure': (v) => { return Math.round(v) },
        'net-present-cost': (v) => { return Math.round(v) },
        'operational-emissions': (v) => { return Math.round(v / 1000) },
    }

    for (let system_name of system_list) {
        for (let subsystem_name of hydrogen_order) {
            let tr = document.createElement('tr');
            if (subsystem_name == hydrogen_order[0]) {
                let td = document.createElement('td');
                td.classList.add('heat-tech');
                td.rowSpan = 3;
                let div = document.createElement('div');
                div.innerHTML = system_names[system_name];
                td.appendChild(div);
                tr.appendChild(td);
            }

            let system_properties = output.systems[system_name][subsystem_name];
            console.log(system_properties);

            let td = document.createElement('td');
            td.innerHTML = hydrogen_display_names[subsystem_name];
            td.colSpan = 3;
            tr.appendChild(td);


            for (let [property_name, fmt_fnc] of Object.entries(h2_format)) {
                let value = fmt_fnc(system_properties[property_name]);
                let td = document.createElement('td');
                td.innerText = value;
                tr.appendChild(td);
            }
            table.appendChild(tr);
        }
    }
}

function build_other_table() {
    const table_headers = [
        "Heating Technology",
        "Upfront Cost<br>(£)",
        "Yearly Cost<br>(£)",
        "Lifetime Cost<br>(£)",
        "Yearly Emissions<br>(kgCO<sub>2</sub>eq)",
    ];

    let table = document.getElementById('output-main-table');
    {
        let tr = document.createElement('tr');
        for (let header of table_headers) {
            console.log(header);
            let th = document.createElement('th');
            if (header == table_headers[0]) {
                th.colSpan = 4;
            }
            let div = document.createElement('div');
            div.innerHTML = header;
            th.appendChild(div);
            tr.appendChild(th);
        }
        table.appendChild(tr);
    }

    let system_list = [
        'biomass-boiler',
        'gas-boiler',
    ];

    const value_format = {
        'operational-expenditure': (v) => { return Math.round(v) },
        'capital-expenditure': (v) => { return Math.round(v) },
        'net-present-cost': (v) => { return Math.round(v) },
        'operational-emissions': (v) => { return Math.round(v / 1000) },
    }

    for (let system_name of system_list) {
        let tr = document.createElement('tr');
        {
            let td = document.createElement('td');
            td.colSpan = 4;
            td.innerHTML = system_names[system_name];
            tr.appendChild(td);
        }

        let system_properties = output.systems[system_name];
        console.log(system_properties);

        for (let [property_name, fmt_fnc] of Object.entries(value_format)) {
            let value = fmt_fnc(system_properties[property_name]);
            let td = document.createElement('td');
            td.innerText = value;
            tr.appendChild(td);
        }
        table.appendChild(tr);
    }
}

function build_tables() {
    build_main_table();
    build_hydrogen_table();
    build_other_table();
}

build_tables()
